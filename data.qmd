---
title: "Your Title"
author: "Your Name"
output: html_document
---

```{r,message = FALSE, warning = FALSE}

# Load necessary libraries
library(ggplot2)
library(readr)
library(dplyr)

# Load the datasetyy
data <- read_csv("ya_veri.csv")

# Filter out 2018 data
data <- filter(data, year != 2018)

# Function to plot gender distribution
plot_gender_distribution <- function(department_name) {
  department_data <- filter(data, department == department_name)
  
  # Define y-axis limits based on department
  y_limits <- if (department_name == "Computer_Eng") {
    c(0, 140)
  } else {
    c(0, 110)
  }
  
  ggplot(department_data) +
    geom_bar(aes(x = factor(year), y = capacity, fill = "Men"), stat = "identity", position = "stack") +
    geom_bar(aes(x = factor(year), y = capacity * (percentage_women / 100), fill = "Women"), stat = "identity", position = "stack") +
    geom_line(aes(x = factor(year), y = valedictorian * 11, group = 1), color = "purple", linewidth = 0.75) +
    geom_point(aes(x = factor(year), y = valedictorian * 11), color = "purple", size = 2) +
    geom_text(aes(x = factor(year), y = capacity, label = paste0(percentage_men, "%")), 
              vjust = -0.5, color = "pink", size = 3, fontface = "bold") +
    geom_text(aes(x = factor(year), y = capacity * (percentage_women / 100), label = paste0(percentage_women, "%")), 
              vjust = 1.5, color = "navy", size = 3, fontface = "bold") +
    geom_text(aes(x = factor(year), y = valedictorian * 11, label = valedictorian), 
              color = "purple", size = 3, fontface = "bold", vjust = -1.5, hjust = 0.5) +
    scale_y_continuous(name = "Capacity", limits = y_limits, breaks = seq(y_limits[1], y_limits[2], by = 10),
                       sec.axis = sec_axis(~ . / 11, name = "Valedictorians", breaks = seq(1, 10, by = 1))) +
    labs(title = department_name, x = "Year", fill = "Gender") +
    scale_fill_manual(values = c("Women" = "pink", "Men" = "navy")) +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5, size = 12),
          axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
          axis.text.y = element_text(size = 10),
          axis.text.y.right = element_text(color = "purple", size = 10),
          axis.title.y.right = element_text(color = "purple", size = 12))
}

# List of departments
departments <- unique(data$department)

# Create and print plots in a single column
for (dept in departments) {
  print(plot_gender_distribution(dept))
}

```

```{r}
# Load necessary libraries
library(tidyr)
library(dplyr)
library(ggplot2)
library(forcats)
library(readr)
library(stringr)  # For str_wrap()

# Load the dataset
data <- read_csv("ya_veri.csv")

# Exclude 2018 and reshape the data
data_tidy <- data %>%
  filter(year != 2018) %>%
  select(department, year, akdeniz, dogu_anadolu, ege, guneydogu_anadolu, ic_anadolu, karadeniz, marmara) %>%
  pivot_longer(
    cols = c(akdeniz, dogu_anadolu, ege, guneydogu_anadolu, ic_anadolu, karadeniz, marmara),
    names_to = "region",
    values_to = "percentage_contribution"
  ) %>%
  mutate(region = fct_relevel(region, 
    "ic_anadolu", "marmara", "guneydogu_anadolu", "doğu_anadolu", "akdeniz", "ege", "karadeniz")) %>%
  filter(!is.na(percentage_contribution)) %>%
  group_by(department, year) %>%
  mutate(region = fct_reorder(region, -percentage_contribution, .desc = TRUE)) %>%
  ungroup()

# Define the color palette, including all regions
region_colors <- c(
  "ic_anadolu" = "#e8736b",
  "marmara" = "#54a115",
  "guneydogu_anadolu" = "#053eb0",
  "doğu_anadolu" = "#ff9900",
  "akdeniz" = "#7705b0",
  "karadeniz" = "#b0054a",
  "ege" = "#d1f299"
)

# Department-Based Plot
ggplot(data=data_tidy, aes(x=year, y=percentage_contribution, fill=region)) +
  geom_bar(stat="identity", position="fill") +
  facet_wrap(~department, ncol = 4) +  # Adjust facet layout
  labs(
    title="Yearly Breakdown by Department",
    x="Year",
    y="Percentage Contribution",
    fill="Region"
  ) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_manual(values = region_colors) +
  theme_minimal(base_size = 10) +
  theme(
    strip.text = element_text(size = 8, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1, size = 6),
    axis.text.y = element_text(size = 8),
    axis.title = element_text(size = 9),
    plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
    legend.title = element_text(size = 10),
    legend.text = element_text(size = 8)
  )

# Save the plot
ggsave("department_breakdown_with_full_legend.png", width = 25, height = 15)

```

```{r}
# Load necessary libraries
# Load necessary libraries
library(tidyr)
library(dplyr)
library(ggplot2)
library(forcats)
library(readr)

# Load the dataset
data <- read_csv("ya_veri.csv")

# Exclude 2018 and reshape the data
data_tidy <- data %>%
  filter(year != 2018) %>%
  select(department, year, akdeniz, dogu_anadolu, ege, guneydogu_anadolu, ic_anadolu, karadeniz, marmara) %>%
  pivot_longer(
    cols = c(akdeniz, dogu_anadolu, ege, guneydogu_anadolu, ic_anadolu, karadeniz, marmara),
    names_to = "region",
    values_to = "percentage_contribution"
  ) %>%
  mutate(region = fct_relevel(region, 
    "ic_anadolu", "marmara", "guneydogu_anadolu", "doğu_anadolu", "akdeniz", "ege", "karadeniz")) %>%
  filter(!is.na(percentage_contribution)) %>%
  group_by(department, year) %>%
  mutate(region = fct_reorder(region, -percentage_contribution, .desc = TRUE)) %>%
  ungroup()

# Define the color palette, including all regions
region_colors <- c(
  "ic_anadolu" = "#e8736b",
  "marmara" = "#54a115",
  "guneydogu_anadolu" = "#053eb0",
  "doğu_anadolu" = "#ff9900",
  "akdeniz" = "#7705b0",
  "karadeniz" = "#b0054a",
  "ege" = "#d1f299"
)

# Plot: Department Breakdown by Year
ggplot(data=data_tidy, aes(x=year, y=percentage_contribution, fill=region)) +
  geom_bar(stat="identity", position="fill") +
  facet_wrap(~department, ncol = 3) +  # Reduce the number of columns to make plots wider
  labs(
    title="Department Breakdown by Year",
    x="Year",
    y="Percentage Contribution",
    fill="Region"
  ) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_manual(values = region_colors) +
  theme_minimal(base_size = 12) +
  theme(
    strip.text = element_text(size = 10, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1, size = 8),
    axis.text.y = element_text(size = 10),
    axis.title = element_text(size = 12),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5, lineheight = 1.2),  # Two-line title
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10),
    legend.key.size = unit(0.5, "cm"),  # Smaller legend boxes
    legend.spacing.y = unit(0.3, "cm"),  # Reduce vertical spacing in legend
    plot.margin = margin(20, 20, 20, 20)  # Adjust margins
  )

# Save the plot
ggsave("department_breakdown_no_whitespace.png", width = 25, height = 18)



```

```{r}
# Load necessary libraries
# Load necessary libraries
library(tidyr)
library(dplyr)
library(ggplot2)
library(forcats)
library(readr)
library(stringr)  # For str_wrap()

# Load the dataset
data <- read_csv("ya_veri.csv")

# Exclude 2018 and reshape the data
data_tidy <- data %>%
  filter(year != 2018) %>%
  select(department, year, akdeniz, dogu_anadolu, ege, guneydogu_anadolu, ic_anadolu, karadeniz, marmara) %>%
  pivot_longer(
    cols = c(akdeniz, dogu_anadolu, ege, guneydogu_anadolu, ic_anadolu, karadeniz, marmara),
    names_to = "region",
    values_to = "percentage_contribution"
  ) %>%
  mutate(region = fct_relevel(region, 
    "ic_anadolu", "marmara", "guneydogu_anadolu", "doğu_anadolu", "akdeniz", "ege", "karadeniz")) %>%
  filter(!is.na(percentage_contribution)) %>%
  group_by(department, year) %>%
  mutate(region = fct_reorder(region, -percentage_contribution, .desc = TRUE)) %>%
  ungroup()

# Define the color palette, including all regions
region_colors <- c(
  "ic_anadolu" = "#e8736b",
  "marmara" = "#54a115",
  "guneydogu_anadolu" = "#053eb0",
  "doğu_anadolu" = "#ff9900",
  "akdeniz" = "#7705b0",
  "karadeniz" = "#b0054a",
  "ege" = "#d1f299"
)

# Plot: Department Breakdown by Year
ggplot(data=data_tidy, aes(x=interaction(department, year), y=percentage_contribution, fill=region)) +
  geom_bar(stat="identity", position="fill") +
  labs(
    title="Department and Year",
    x="Department and Year (Alphabetical Order)",
    y="Percentage Contribution",
    fill="Region"
  ) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_manual(values = region_colors) +
  theme_minimal(base_size = 10) +
  theme(
    axis.text.x = element_blank(),  # Remove x-axis labels for less clutter
    axis.ticks.x = element_blank(),
    axis.text.y = element_text(size = 10),
    axis.title = element_text(size = 12),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5, lineheight = 1.2),  # Two-line title
    plot.title.position = "plot",
    legend.title = element_text(size = 10),  # Smaller legend title
    legend.text = element_text(size = 8),  # Smaller legend text
    legend.key.size = unit(0.5, "cm"),  # Smaller legend boxes
    legend.spacing.y = unit(0.2, "cm"),  # Reduce vertical spacing between legend items
    plot.margin = margin(40, 60, 40, 40)  # Add right margin for wider plot
  )

# Save the plot with a wider layout
ggsave("department_contributions_wider.png", width = 35, height = 16)

```
